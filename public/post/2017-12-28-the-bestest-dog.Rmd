---
title: The bestest dog
author: ~
date: '2017-12-28'
slug: the-bestest-dog
categories: ["R"]
tags: ["dogs"]
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
require(twitteR)
require(ROAuth)
library("purrr")
library(stringr)
library(readr)
library("ggplot2")
library(dplyr)
library(tm)
# Start -----
setwd("/Users/emmavestesson/Documents/R folder")
load("twitter_credentials.R")

# This function wraps the OAuth authentication handshake functions
# from the httr package for a twitteR session
setup_twitter_oauth(
  consumer_key = consumerKey,
  consumer_secret = consumerSecret, 
  access_token = accessToken, 
  access_secret = accessSecret)

```

## Who is the bestest dog?

After calling my parents' dog the bestest dog of all I wanted to find out who the internet thought was the bestest dog. "We rate dogs" on twitter was the obvious choice as the almighty judge of all dogs.

I started by pulling all tweets by @rate_dogs using the twitteR and ROAuth packages. I decide to not include retweets or replies as I only cared about the official opinion of @rate_dogs. 


```{r}
rate_dogs_list <- userTimeline("dog_rates",n=3200,includeRts = FALSE, excludeReplies=TRUE)
rate_dogs_df1 <- twListToDF(rate_dogs_list) 
id_vars <- rate_dogs_df1  %>% 
  mutate(id=as.numeric(id)) %>% 
  transmute(min_id= min(id), max_id= max(id)) %>% 
  distinct()
rate_dogs_list2 <- userTimeline("dog_rates",n=3200, maxID= id_vars$min, includeRts = FALSE, excludeReplies=TRUE)
rate_dogs_df2 <- twListToDF(rate_dogs_list2)

id_vars <- rate_dogs_df2  %>% 
  mutate(id=as.numeric(id)) %>% 
  transmute(min_id= min(id), max_id= max(id)) %>% 
  distinct()

rate_dogs_list3 <- userTimeline("dog_rates",n=3200, maxID= id_vars$min, includeRts = FALSE, excludeReplies=TRUE)

rate_dogs_df3 <- twListToDF(rate_dogs_list3)

id_vars <- rate_dogs_df3  %>% 
  mutate(id=as.numeric(id)) %>% 
  transmute(min_id= min(id), max_id= max(id)) %>% 
  distinct()
rate_dogs_list4 <- userTimeline("dog_rates",n=3200, maxID= id_vars$min, includeRts = FALSE, excludeReplies=TRUE)

rate_dogs_df4 <- twListToDF(rate_dogs_list4)

id_vars <- rate_dogs_df4  %>% 
  mutate(id=as.numeric(id)) %>% 
  transmute(min_id= min(id), max_id= max(id)) %>% 
  distinct()
rate_dogs_list5 <- userTimeline("dog_rates",n=3200, maxID= id_vars$min, includeRts = FALSE, excludeReplies=TRUE)

rate_dogs_df5 <- twListToDF(rate_dogs_list4)



rate_dogs_df <- bind_rows(rate_dogs_df1, rate_dogs_df2, rate_dogs_df3, rate_dogs_df4, rate_dogs_df5) 
  

```


Once I had the raw data I needed to extract the scores. I did this using a regular expression that looked for a number followed by "/10". For some reason I don't understand the variable I created was added to the data set as a matrix so I had to add a step to make it a vector.  

```{r , echo=TRUE}

rate_dogs_scored <- rate_dogs_df %>% 
  mutate(score=str_match(text,pattern="[0-9]+/10")) 

rate_dogs_scored$score <- as.vector(rate_dogs_scored$score)

total_rows <- nrow(rate_dogs_scored)
missing<- sum(is.na(rate_dogs_scored$score))
total_rows <- nrow(rate_dogs_scored )

# rate_dogs_scored_untrunc <- rate_dogs_scored %>% 
#   group_by(truncated) %>% 
  

untrunc_rows <-  nrow(rate_dogs_scored %>% 
                        filter(truncated==FALSE))
untrunc_missing<- sum(is.na(rate_dogs_scored %>% 
                        filter(truncated==FALSE) %>% 
                          select(score)))

```

There are `r total_rows` rows in my data frame but only `r total_rows-missing` actually have a score. Some tweets will not have a score as they were not rating dogs but unfortunately some tweets are truncated. I am fairly certain that tweets without a score that were not truncuated were tweets that did not score dogs.  

After plotting the number of a times a 
```{r}
  
ggplot(rate_dogs_scored, aes(x=retweetCount,y=favoriteCount)) + geom_point() +
  theme_bw() + ggtitle("Distribution of scores") + ylab("Favourites")

ggplot(rate_dogs_scored, aes(x=score,y=favoriteCount)) + geom_point() +
  theme_bw() + ggtitle("Number of times favourited") + ylab("Favourites")


```

